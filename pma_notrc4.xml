<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>sologhost:pmattachments</id>
<version>1.6</version>
<file name="$themedir/ManageAttachments.template.php">
<operation>
		<search position="end" /><add><![CDATA[

function template_pm_attachment_repair()
{
	global $context, $txt, $scripturl;

	// If we've completed just let them know!
	if ($context['completed'])
	{
	echo '
	<div id="manage_attachments">
		<h3 class="catbg"><span class="left"></span>
			<img src="', $settings['images_url'], '/admin/post_moderation_allow.gif" alt="" /> ', $txt['repair_attachments_complete'], '
		</h3>
		<div class="windowbg">
			<span class="topslice"><span></span></span>
			<div class="content">
				', $txt['repair_attachments_complete_desc'], '
			</div>
			<span class="botslice"><span></span></span>
		</div>
	</div>
	<br class="clear" />';
	}
	
	// What about if no errors were even found?
	elseif (!$context['errors_found'])
	{
		echo '
	<div id="manage_attachments">
		<h3 class="catbg"><span class="left"></span>
			<img src="', $settings['images_url'], '/admin/post_moderation_allow.gif" alt="" /> ', $txt['repair_attachments_complete'], '
		</h3>
		<div class="windowbg">
			<span class="topslice"><span></span></span>
			<div class="content">
				', $txt['repair_attachments_no_errors'], '
			</div>
			<span class="botslice"><span></span></span>
		</div>
	</div>
	<br class="clear" />';
	}
	// Otherwise, I'm sad to say, we have a problem!
	else
	{
		echo '
	<div id="manage_attachments">
		<form action="', $scripturl, '?action=admin;area=manageattachments;sa=pmrepair;fixErrors=1;step=0;substep=0;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
			<h3 class="catbg"><span class="left"></span>
				<img src="',$settings['images_url'], '/admin/post_moderation_deny.gif" alt="" /> ', $txt['repair_attachments'], '
			</h3>
			<div class="windowbg">
				<span class="topslice"><span></span></span>
				<div class="content">
					<p>', $txt['repair_attachments_error_desc'], '</p>
					';

		// Loop through each error reporting the status
		foreach ($context['repair_errors'] as $error => $number)
		{
		
		
			if (!empty($number))
				echo '
						<input type="checkbox" name="to_fix[]" id="', $error, '" value="', $error, '" class="input_check" />
						<label for="', $error, '">', sprintf($txt['attach_pmrepair_' . $error], $number), '</label><br />';
			}
	
			echo '		<br />
						<input type="submit" value="', $txt['repair_attachments_continue'], '" class="button_submit" />
						<input type="submit" name="cancel" value="', $txt['repair_attachments_cancel'], '" class="button_submit" />
					</div>
					<span class="botslice"><span></span></span>
				</div>
			</form>
		</div>
		<br class="clear" />';
	}
}

function template_pmattachment_paths()
{
	template_show_list('pmattach_paths');
}

]]></add>
	</operation>
</file>
</modification>